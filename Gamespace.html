<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zombie Dash</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
      body {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      var config = {
        type: Phaser.AUTO,
        width: 1500,
        height: 600,
        physics: {
          default: "arcade",
          arcade: {
            gravity: { y: 300 },
            debug: true,
          },
        },
        scene: {
          preload: preload,
          create: create,
          update: update
        },
      };

      let player;
      let platforms;

      var game = new Phaser.Game(config);

      const gameState = {
        play: true,
        zombiesCreated: 0,
        delay: 2000,
        deadAnimationPlayed: false,
        remainingLives: 3
      };

      function preload() {
        this.load.image("sky", "assets/png/2/layers/l1_background.png");
        this.load.image("hills", "assets/png/2/layers/l2_hills.png");
        this.load.image("clouds", "assets/png/2/layers/l3_clouds.png");
        this.load.image("ruin", "assets/png/2/layers/l4_ruin.png");
        this.load.image("ground", "assets/png/2/layers/l5_ground.png");
        this.load.image("houses", "assets/png/2/layers/l6_houses.png");
        this.load.image("ground", "assets/platform.png");
        this.load.image("dumpster", "assets/grave-tiles/png/Objects/dumpster.png")
        this.load.image("trashcan", "assets/grave-tiles/png/Objects/trashcan.png")
        this.load.image("zombie-group", "assets/grave-tiles/png/Objects/zombie-group.png")
        this.load.image("platform", "assets/platform.png")
        this.load.image("tile-platform", "assets/tileplatform.png")
        this.load.multiatlas('hero', 'assets/hero.json', "assets");
        this.load.multiatlas('male', 'assets/male.json', "assets");
        this.load.multiatlas('female', 'assets/female.json', "assets");
        this.load.audio('zombie-dance', ['assets/audio/zombie-dance.mp3', 'assets/audio/zombie-dance.ogg']);
        this.load.audio('male-noise-1', ['assets/audio/noises/male-noise-1.mp3', 'assets/audio/noises/male-noise-1.ogg']);
        this.load.audio('male-noise-2', ['assets/audio/noises/male-noise-2.mp3', 'assets/audio/noises/male-noise-2.ogg']);
        this.load.audio('male-noise-3', ['assets/audio/noises/male-noise-3.mp3', 'assets/audio/noises/male-noise-3.ogg']);
        this.load.audio('male-noise-4', ['assets/audio/noises/male-noise-4.mp3', 'assets/audio/noises/male-noise-4.ogg']);
        this.load.audio('male-noise-5', ['assets/audio/noises/male-noise-5.mp3', 'assets/audio/noises/male-noise-5.ogg']);
        this.load.audio('male-noise-6', ['assets/audio/noises/male-noise-6.mp3', 'assets/audio/noises/male-noise-6.ogg']);
        this.load.audio('male-noise-7', ['assets/audio/noises/male-noise-7.mp3', 'assets/audio/noises/male-noise-7.ogg']);
        this.load.audio('female-noise-1', ['assets/audio/noises/female-noise-1.mp3', 'assets/audio/noises/female-noise-1.ogg']);
        this.load.audio('female-noise-2', ['assets/audio/noises/female-noise-2.mp3', 'assets/audio/noises/female-noise-2.ogg']);
        this.load.audio('female-noise-3', ['assets/audio/noises/female-noise-3.mp3', 'assets/audio/noises/female-noise-3.ogg']);
        this.load.audio('female-noise-4', ['assets/audio/noises/female-noise-4.mp3', 'assets/audio/noises/female-noise-4.ogg']);
        this.load.audio('female-noise-5', ['assets/audio/noises/female-noise-5.mp3', 'assets/audio/noises/female-noise-5.ogg']);
        this.load.audio('female-noise-6', ['assets/audio/noises/female-noise-6.mp3', 'assets/audio/noises/female-noise-6.ogg']);
        this.load.audio('female-noise-7', ['assets/audio/noises/female-noise-7.mp3', 'assets/audio/noises/female-noise-7.ogg']);
      }

      function create() {
        this.add.image(700, 300, "sky");
        this.add.image(700, 700, "hills");
        this.add.image(700, 300, "clouds");
        this.add.image(700, 300, "ruin");
        this.add.image(700, 175, "houses");
        // this.add.image(700, 300, "ground");
        this.add.image(530, 500, "zombie-group").setScale(0.2)

        

        this.backgroundMusic = this.sound.add('zombie-dance', { volume: 0.8, loop: true });
        this.backgroundMusic.play();
        this.noise1 = this.sound.add('male-noise-1', { volume: 2, loop: false });
        this.noise2 = this.sound.add('male-noise-2', { volume: 2, loop: false });
        this.noise3 = this.sound.add('male-noise-3', { volume: 2, loop: false });
        this.noise4 = this.sound.add('male-noise-4', { volume: 2, loop: false });
        this.noise5 = this.sound.add('male-noise-5', { volume: 2, loop: false });
        this.noise6 = this.sound.add('male-noise-6', { volume: 2, loop: false });
        this.noise7 = this.sound.add('male-noise-7', { volume: 2, loop: false });
        this.noise8 = this.sound.add('female-noise-1', { volume: 2, loop: false });
        this.noise9 = this.sound.add('female-noise-2', { volume: 2, loop: false });

        
        platforms = this.physics.add.staticGroup();

        //Add 'platforms' to page
        platforms.create(750, 300, "dumpster").setScale(0.2).refreshBody();
        platforms.create(1150, 560, "trashcan").setScale(0.05).refreshBody();
        platforms.create(1500, 600, "platform").setScale(10, 0.2).refreshBody();
        platforms.create(100, 200, 'tile-platform').setScale(1).refreshBody();
        platforms.create(1500, 200, 'tile-platform').setScale(1).refreshBody();
        
        
        // platforms.create(600, 400, "ground");
        // platforms.create(50, 250, "ground");
        // platforms.create(750, 220, "ground");

        // player = this.physics.add.sprite(200, 450, "dude");
        // player.setBounce(0.2);
        // player.setCollideWorldBounds(true);

        // Add 'player' sprite to scene
        player = this.physics.add.sprite(20, 400, 'hero', 'idle/idle01.png');
        player.setScale(0.2);
        player.setBounce(0.2);
        player.setCollideWorldBounds(true);
        player.body.setSize(250, 400, true);
        player.body.offset.x = 250;
        player.body.offset.y = 100;

        // 'player-idle' animation
        let idleFrameNames = this.anims.generateFrameNames('hero', {
          start: 1, end: 10, zeroPad: 2,
          prefix: 'idle/idle', suffix: '.png'
        })
        console.log(JSON.stringify(idleFrameNames));
        this.anims.create({ key: 'player-idle', frames: idleFrameNames, frameRate: 10, repeat: -1 });
        player.anims.play('player-idle');

        // 'player-run' animation
        let runFrameNames = this.anims.generateFrameNames('hero', {
          start: 1, end: 10, zeroPad: 2,
          prefix: 'run/run', suffix: '.png'
        })
        this.anims.create({
          key: "player-run",
          frames: runFrameNames,
          frameRate: 10,
          repeat: -1,
        });


        // 'player-jump' animation
        let jumpFrameNames = this.anims.generateFrameNames('hero', {
          start: 1, end: 12, zeroPad: 2,
          prefix: 'jump/jump', suffix: '.png'
        })

        this.anims.create({
          key: 'player-jump',
          frames: jumpFrameNames,
          frameRate: 12,
          repeat: 0
        })

        // 'player-dead' animation
        let deadFrameNames = this.anims.generateFrameNames('hero', {
          start: 1, end: 10, zeroPad: 2,
          prefix: 'dead/dead', suffix: '.png'
        })

        this.anims.create({
          key: 'player-dead',
          frames: deadFrameNames,
          frameRate: 12,
          repeat: 0
        })

        // 'male-idle' zombie animation
        let idleMaleFrameNames = this.anims.generateFrameNames('male', {
          start: 1, end: 15, zeroPad: 2,
          prefix: 'male-idle/idle', suffix: '.png'
        })
        this.anims.create({ key: 'male-idle', frames: idleMaleFrameNames, frameRate: 10, repeat: -1 });

        // 'male-walk' zombie animation
        let maleWalkFrameNames = this.anims.generateFrameNames('male', {
          start: 1, end: 10, zeroPad: 2,
          prefix: 'male-walk/walk', suffix: '.png'
        })
        this.anims.create({
          key: "male-walk",
          frames: maleWalkFrameNames,
          frameRate: 10,
          repeat: -1,
        });

        // 'female-walk' zombie animation
        let femaleWalkFrameNames = this.anims.generateFrameNames('female', {
          start: 1, end: 10, zeroPad: 2,
          prefix: 'female-walk/walk', suffix: '.png'
        })
        this.anims.create({
          key: 'female-walk',
          frames: femaleWalkFrameNames,
          frameRate: 10,
          repeat: -1
        });


        this.physics.add.collider(player, platforms);

        gameState.cursors = this.input.keyboard.createCursorKeys();

        // Add zombie group
        const zombies = this.physics.add.group();

        function zombieGen() {
          function getRandom(min, max) {
          return Math.random() * (max - min) + min;
            }
          let zombieGender = 'male';
          if (Math.random() <= 0.5) {
            zombieGender = 'female';
          }
          let thisZombie = zombies.create(1500, 50, `${zombieGender}`, `${zombieGender}-idle/idle01.png`);
          thisZombie.setScale(0.2);
          thisZombie.setBounce(0.2);
          thisZombie.flipX = true;
          thisZombie.body.setSize(200, 380, true);
          thisZombie.body.offset.x = 100;
          thisZombie.body.offset.y = 150;
          thisZombie.anims.play(`${zombieGender}-walk`);
          thisZombie.setVelocityX(-50);
          this.physics.add.collider(thisZombie, platforms);
          gameState.zombiesCreated += 1;
          console.log(gameState.zombiesCreated);
          let theNum = Math.floor(getRandom(2, 7));
          this.randomNoise = this.sound.add(`${zombieGender}-noise-${theNum}`, { volume: 2, loop: false });
          this.randomNoise.play();
        }
        const zombieGenLoop = this.time.addEvent({
          delay: gameState.delay,
          callback: zombieGen,
          callbackScope: this,
          loop: true,
        });


        this.physics.add.collider(player, zombies, () => {
          gameState.play = false;
          this.backgroundMusic.stop();
          this.noise1.play();
          this.physics.pause();
          player.anims.stop();
          // zombies.anims.stop();
          this.add.text(350, 250, 'Game Over', { fontSize: '30px', fill: '#FFFFFF' });
          this.add.text(300, 300, 'Click to Restart', { fontSize: '25px', fill: '#FFFFFF' });
          this.input.on('pointerup', () => {
            gameState.play = true;
            gameState.deadAnimationPlayed = false;
            this.scene.restart();
          })
        });


      }

      function update() {
        if (gameState.play) {
          if (gameState.cursors.left.isDown) {
            player.setVelocityX(-160);
            player.flipX = true;
            player.anims.play("player-run", true);
          } else if (gameState.cursors.right.isDown) {
            player.setVelocityX(160);
            player.anims.play("player-run", true);
            player.flipX = false
          } else {
            player.setVelocityX(0);
            player.anims.play("player-idle", true);
            player.flipX = false;
          }

          if (gameState.cursors.up.isDown && player.body.touching.down) {
            player.setVelocityY(-330);
          }
        } else {
          if (gameState.deadAnimationPlayed === false) {
            gameState.deadAnimationPlayed = true;
            player.anims.play("player-dead", true);
            player.y = 550;
          }
        }
      }
    </script>
  </body>
</html>
